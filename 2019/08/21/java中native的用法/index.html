
<!DOCTYPE html>
<html lang class="loading">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>java中native的用法 - xiyou</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate">
    <meta name="keywords" content="xiyou,"> 
    <meta name="description" content="在看java源码时，我们有时能看见用native关键字声明的方法：public native String intern();
那么native方法是什么?native方法是非java代码实现的方法,"> 
    <meta name="author" content="xiyou"> 
    <link rel="alternative" href="atom.xml" title="xiyou" type="application/atom+xml"> 
    <link rel="icon" href="/blog/img/favicon.png"> 
    
    <link rel="stylesheet" href="/blog/css/diaspora.css">
	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({
              google_ad_client: "ca-pub-8691406134231910",
              enable_page_level_ads: true
         });
    </script>
    <script async custom-element="amp-auto-ads" src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
</head>
</html>
<body class="loading">
    <span id="config-title" style="display:none">xiyou</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="iconfont icon-home image-icon" href="javascript:;" data-url="http://xiyou13921.gitee.io/blog"></a>
    <div title="播放/暂停" class="iconfont icon-play"></div>
    <h3 class="subtitle">java中native的用法</h3>
    <div class="social">
        <div>
            <div class="share">
                <a title="获取二维码" class="iconfont icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class="main">
        <h1 class="title">java中native的用法</h1>
        <div class="stuff">
            <span>八月 21, 2019</span>
            

        </div>
        <div class="content markdown">
            <p>在看java源码时，我们有时能看见用native关键字声明的方法：<br>public native String intern();</p>
<p><strong>那么native方法是什么?</strong><br>native方法是非java代码实现的方法。<br>native关键字修饰一个方法，那么说明这个方法是一个原生态方法，方法对应的实现不是在当前文件，而是在用其他语言（例如C和C++）实现的文件中。java语言本身不能对操作系统底层进行访问和操作，但是可用过JNI接口调用其他语言来实现对底层的访问。<br>JNI是java本地接口(Java Native Interface)，是一个本地编程接口，他是java软件开发工具箱(Java Software Development Kit,SDK)的一部分。JNI允许java代码使用以其他语言编写的代码和代码库。Invocation API（JNI的一部分）可以用来将Java虚拟机（JVM）嵌入到本地应用程序中，从而允许程序员从本地代码内部调用Java代码。</p>
<a id="more"></a>
<p><strong>native的用法：</strong>  </p>
<ul>
<li>1.编写带有native声明的方法的java类 (java文件)</li>
<li>2.使用javac命令编译编写的java类(class文件)</li>
<li>3.使用javah -jin ****来生成后缀名为.h的头文件（.h的文件）</li>
<li>4.使用其他语言(C、C++)实现本地方法</li>
<li>5.将本地方法编写的文件生成动态链接库(dll文件)</li>
</ul>
<p><strong>例子：</strong><br>1.java文件</p>
<pre><code>public class HelloWorld {

    public native void hello(String name);

    static{
        System.loadLibrary(&quot;hello&quot;);
    }

    public static void main(String[] args){
        new HelloWorld().hello(&quot;jni&quot;);
    }
}</code></pre><p>2.javac命令编译  </p>
<pre><code>javac HelloWorld.java</code></pre><p>3.生成.h文件（注意：javah NativeTest后边不跟.class）  </p>
<pre><code>javah -jni HelloWorld</code></pre><p>如果执行出现报错信息：<br>错误: 找不到 ‘NativeTest’ 的类文件。<br>执行以下命令(在想要存储生成的.h文件目录下 javah + -classpath + 项目包目录前 + -jni + 包名类名):  </p>
<pre><code>javah  -classpath E:/workspace_sts/JAVA/src/build/classes -jni test.HelloWorld</code></pre><p>执行成功后会在对应目录下生成一个.h后缀的文件，文件内容如下:  </p>
<pre><code>/* DO NOT EDIT THIS FILE - it is machine generated */
#include &lt;jni.h&gt;
/* Header for class test_HelloWorld */

#ifndef _Included_test_HelloWorld
#define _Included_test_HelloWorld
#ifdef __cplusplus
extern &quot;C&quot; {
#endif
/*
 * Class:     test_HelloWorld
 * Method:    hello
 * Signature: (Ljava/lang/String;)V
 */
JNIEXPORT void JNICALL Java_test_HelloWorld_hello
  (JNIEnv *, jobject, jstring);

#ifdef __cplusplus
}
#endif
#endif</code></pre><p>4.实现本地方法(编写C文件：HelloWorldImpl.c)  </p>
<pre><code>#include &lt;jni.h&gt;
#include &quot;test_HelloWorld.h&quot;
#include &lt;stdio.h&gt;
JNIEXPORT void JNICALL Java_test_HelloWorld_hello(JNIEnv *env,jobject obj,jstring name){

    const char *str;
    str = (*env)-&gt;GetStringUTFChars(env,name,NULL);
    if(str == NULL){
        return;
    }

    printf(&quot;Hello World! %s \n&quot;,str);
    return;
}</code></pre><p>5.生成动态链接库，编译c文件产生dll文件，在控制台下使用cl -i调试</p>
<pre><code>cl -I &quot;G:\Program Files\Java\jdk1.8.0_111\include&quot; -I &quot;G:\Program Files\Java\jdk1.8.0_111\include\win32&quot; -LD HelloWorldImpl.c -Fehello.dll</code></pre><p>注意：生成的dll文件名在选项-Fe后面配置，这里是hello，因为在HelloWorld.java文件中我们loadLibary的时候使用的名字是hello。当然这里修改之后那里也需要修改。<br>执行成功后会返回如下结果：  </p>
<pre><code>用于 x86 的 Microsoft (R) C/C++ 优化编译器 19.16.27031.1 版
版权所有(C) Microsoft Corporation。保留所有权利。

HelloWorldImpl.c
Microsoft (R) Incremental Linker Version 14.16.27031.1
Copyright (C) Microsoft Corporation.  All rights reserved.

/dll
/implib:hello.lib
/out:hello.dll
HelloWorldImpl.obj
  正在创建库 hello.lib 和对象 hello.exp</code></pre><p><strong>★关键 hello.dll文件需要存放到 jdk的bin目录或者system32下面</strong></p>
<p>具体内容请参考以下文章：<br><a href="https://www.cnblogs.com/b3051/p/7484501.html" target="_blank" rel="noopener">https://www.cnblogs.com/b3051/p/7484501.html</a><br><a href="http://blog.sina.com.cn/s/blog_4d18e4240100gfgy.html" target="_blank" rel="noopener">http://blog.sina.com.cn/s/blog_4d18e4240100gfgy.html</a><br><a href="https://blog.csdn.net/origin100/article/details/7305222" target="_blank" rel="noopener">https://blog.csdn.net/origin100/article/details/7305222</a>  </p>
<p>6.运行java程序，输出Hello World! jni<br>如果运行出现Can’t load IA 32-bit .dll on a AMD 64-bit platform错误，请参考以下文章：<a href="https://blog.csdn.net/cbbbc/article/details/45772063" target="_blank" rel="noopener">https://blog.csdn.net/cbbbc/article/details/45772063</a></p>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src>
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        
                            <li title="0" data-url="http://link.hhtjim.com/163/425570952.mp3"></li>
                        
                    
                        
                            <li title="1" data-url="http://link.hhtjim.com/163/425570952.mp3"></li>
                        
                    
                </ul>
            
        </div>
        
    <div id="gitalk-container" class="comment link" data-enable="false" data-ae="false" data-ci data-cs data-r data-o data-a data-d="false">查看评论</div>


    </div>
    
</div>


    </div>
</div>
</body>

<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/blog/js/plugin.js"></script>
<script src="/blog/js/typed.js"></script>
<script src="/blog/js/diaspora.js"></script>
<link rel="stylesheet" href="/blog/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/blog/photoswipe/default-skin/default-skin.css">
<script src="/blog/photoswipe/photoswipe.min.js"></script>
<script src="/blog/photoswipe/photoswipe-ui-default.min.js"></script>

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>






</html>
